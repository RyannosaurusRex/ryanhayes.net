{"expireTime":9007200859288004000,"key":"transformer-remark-markdown-html-698332db930f616be052e612b5905c47-gatsby-remark-embed-gistgatsby-remark-responsive-iframegatsby-remark-prismjsgatsby-remark-copy-linked-filesgatsby-remark-smartypantsgatsby-remark-abbrgatsby-remark-imagesgatsby-remark-prismjs-","val":"<p>McAfee Endpoint Security and I have a love/hate relationship in that I hate it when it gets in my way and love it when it‚Äôs not installed. In general, I appreciate security and security research, but recently I had been trying out (or attempting to try out) Docker and Kubernetes for a project I‚Äôm working on. It‚Äôs a .NET 4.6 web application, and as such, requires Windows Server Core (as opposed to the much lighter-weight, new Windows Nano Server or a Linux-based container).¬† The fact that we now have an option to effectively containerize any application, including a windows application, is incredible. So yesterday, I decided to try and set it up. Here‚Äôs how it went.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1170px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.88541666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAB2GAAAdhgFdohOBAAACqElEQVQoz2WRWUjUURTG/9BjFL2UtJElRYtQCWkr1YsildBDGBVo2aJo+FBOLjFkpOOSZeU0LqVliajRpqbTjJZRKg2VZeaY+p8UtXBSZ3ecyF93RnqpAx/fdy7nfueeeyREuD0efoxbmbA7GffC5mDC4WJM8KjFLs5dmAVbnS6+j1lwuadEnYOfVruvxjHp9towPT2N5BVTnl++gjHrzCUvPFOT2B12bHYbvz1CO53CyO1r5jW0+OptPkOn28PfkNTHyyk5XUlJfCWliVUUnrjH4/xmun7+4v2wm44RN22Dk2jaLewqHiSycoQDFUNElA8RXjZETUsn79+28qa1lY6ODqTD8xJJWK0kbuV5Ypae48ic05zbc5PQu0MEXuln43WZdYLX58tIsZ+Yo+xmrsCslC8i70RR9Iwn1RVUVdeg1WqRaq818azgBfU3mqnN1/MwuxFD7Uf+jbYBF6mNo2Q0m0nXm7nk5SYzrz7J9H810m3sQZZF08wINRn7CsgQrNqv4WJYPuUX6njY7aD8nYX7HyzcEXxBN0rg1T7Cbn8jvPQbOzQmgsTrSxsMvH6pp6n5BQaDASna7yxRC84QLRAl9KHZCaRH3iLqwTChxTJ7S03sLpLZXjiAdLYHv0yZ+Rky8y72i/wr58ueU/+omsdPa2dGPumfQmJgOslbs0nekkXMYgWa2Ir/Rv48bCO3rotCfQ83tF/Q6Ixc1xpp7+zF1N9Hb28fJpNpxjA2IM23lHixnGMLFWQdVKPWiC9QZZGdk0OmSkVasoLg9WvYvS2Y0J1b2RESxPZNGyi8qUan19PQ0EBLSwvSqeWpeE1PLkvBq4/6JaGKLCD3cg6pqWkolUqSkpKIjYtj0ZKlrFkbSHDIZlauWo3/igDy8vJ8o9bV16PT6fgDVX1RP1SCoZYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/9bfab2653368fd96f0354778edbfdc74/d3720/image1.webp 293w,\n/static/9bfab2653368fd96f0354778edbfdc74/adc41/image1.webp 585w,\n/static/9bfab2653368fd96f0354778edbfdc74/0cf77/image1.webp 1170w,\n/static/9bfab2653368fd96f0354778edbfdc74/8d143/image1.webp 1755w,\n/static/9bfab2653368fd96f0354778edbfdc74/95753/image1.webp 1920w\"\n          sizes=\"(max-width: 1170px) 100vw, 1170px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/9bfab2653368fd96f0354778edbfdc74/8bef6/image1.png 293w,\n/static/9bfab2653368fd96f0354778edbfdc74/7b7df/image1.png 585w,\n/static/9bfab2653368fd96f0354778edbfdc74/3e398/image1.png 1170w,\n/static/9bfab2653368fd96f0354778edbfdc74/af797/image1.png 1755w,\n/static/9bfab2653368fd96f0354778edbfdc74/73135/image1.png 1920w\"\n          sizes=\"(max-width: 1170px) 100vw, 1170px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/9bfab2653368fd96f0354778edbfdc74/3e398/image1.png\"\n          alt=\"Windows docker\"\n          title=\"Windows docker\"\n        />\n      </picture>\n    </span></p>\n<p>The only potential downside that I had heard about Windows Server Core containers were that they were pretty big. When I say big I mean like real big. 10GB big.</p>\n<blockquote class=\"twitter-tweet\" data-lang=\"en\">\n  <p dir=\"ltr\" lang=\"en\">\n    Any issues with the size? ...we were playing with those and they were up into the 10 gig range.\n  </p>\n  \n  <p>\n    ‚Äî Tom Pardue (@tparlimited) <a href=\"https://twitter.com/tparlimited/status/1016732280138731521?ref_src=twsrc%5Etfw\">July 10, 2018</a>\n  </p>\n</blockquote>\n<p>Ok, fine, that‚Äôs‚Ä¶that‚Äôs not good but there‚Äôs no other way to run full framework .NET apps inside Docker without it being in a WindowsServerCore container, so it‚Äôs something I‚Äôll have to live with for now.</p>\n<h2>Installing Docker and gotchas</h2>\n<p>Installing Docker on Windows with McAfee is pretty straightforward. This was the first time I‚Äôd installed it in a couple years, so I was pleasantly surprised when the entire thing was pretty seamless. The wizard created the necessary docker-users security group and added me to it and has a pretty nice interface. There were a few initial setup steps that were unclear I had to lookup, though:</p>\n<ol>\n<li><strong>You need to add your user to the Hyper-V Administrators group.</strong> For whatever reason, the Docker for Windows installation created the docker-users group and added me there, but didn‚Äôt to the existing Hyper-V Administrators group. ü§∑ This could be McAfee preventing the proper setup, but there were no error messages that I saw in the output related to this.</li>\n<li><strong>When building a docker container via the command line interface (Docker CLI)</strong>, the login information is different from what you use to log into the website.¬† The website accepts you username OR your email address (I use my email address), but <strong>the CLI will only accept your username, and not the email address.</strong>¬† It also doesn‚Äôt tell you why the login fails, so just get in a habit of using your username.</li>\n</ol>\n<h2>Issues building a docker image with McAfee Endpoint Security installed</h2>\n<p>Everything seemed to be going as well as I could expect until it came time to run <code class=\"language-text\">docker build</code>¬†on my dockerfile and get everything set up.¬† It seemed to be pulling things from the registry OK, but then I was met with this error message:</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token function\">PS</span> C:\\WINDOWS\\system32> docker pull microsoft<span class=\"token operator\">/</span>windowsservercore  \n<span class=\"token keyword\">Using</span> default tag: latest  \nlatest: Pulling <span class=\"token keyword\">from</span> microsoft<span class=\"token operator\">/</span>windowsservercore  \n9c7f9c7d9bc2: Extracting <span class=\"token punctuation\">[</span>==================================================><span class=\"token punctuation\">]</span> 3<span class=\"token punctuation\">.</span>738 GB<span class=\"token operator\">/</span>3<span class=\"token punctuation\">.</span>738 GB  \nd33fff6043a1: Download complete  \nfailed to register layer: rename C:\\ProgramData\\Docker\\image\\windowsfilter\\layerdb\\tmp\\<span class=\"token function\">write</span><span class=\"token operator\">-</span><span class=\"token function\">set</span><span class=\"token operator\">-</span>925881297 C:\\ProgramData\\Docker\\image\\windowsfilter\\layerdb\\sha256\\3fd27ecef6a323f5ea7f3fde1f7b87a2dbfb1afa797f88fd7d20e8dbdc856f67: Access is denied<span class=\"token punctuation\">.</span></code></pre></div>\n<p>Ok, so let‚Äôs look at what‚Äôs happening here. <strong>It‚Äôs saying it can‚Äôt register a layer because access is denied on my computer‚Äôs file system, but I‚Äôm administrator!</strong> What could possibly be the issue? Then I remember. <em>McAfee.</em> A quick Google search showed a lot of other folks having the same kind of issue, and ends up that McAfee doesn‚Äôt even support Windows containers. Yea, that‚Äôs right.</p>\n<h3>McAfee Endpoint Security Does Not Support Windows-based Docker Containers!</h3>\n<p>After tons of research, the answer from McAfee itself (according to a knowledge base article), is that McAfee Endpoint Security does not support Windows Docker containers! It seems the main issues were:</p>\n<ul>\n<li>DNS does not resolve</li>\n<li>Performance issues with containers</li>\n<li>Slowness in opening containers</li>\n<li>Firewall/NAT issues</li>\n</ul>\n<p>To take a look for yourself, here‚Äôs the original <a href=\"https://kc.mcafee.com/corporate/index?page=content&#x26;id=KB90041&#x26;actp=null&#x26;viewlocale=en_US&#x26;showDraft=false&#x26;platinum_status=false&#x26;locale=en_US\">KB article on Windows Docker containers not being supported by McAfee</a>. McAfee updates this article with the current support status, so check here for any updates to McAfee‚Äôs support for both Docker on Windows as well as running McAfee inside of a Docker container (not that you would want to do that, but it‚Äôs not supported currently).</p>\n<h2>How can I run Windows Docker Containers on Windows if McAfee doesn‚Äôt support it?</h2>\n<p>There are actually a few workarounds that have been successful for me and my team:</p>\n<h3>Virtual Machines</h3>\n<p>First, you can use the docker tools inside a separate ‚Äúreal‚Äù virtual machine (using VMWare, VirtualBox, etc) and actually perform the work there. This gets you around McAfee being on the VM directly, but also has a few drawbacks. It will slow your workflow down as you‚Äôll have the VM to jump through from your local machine to the docker tools and images you may be running. This is not ideal, but might give you some runway until McAfee can add support for Docker on Windows in the future.</p>\n<h3>.NET Core!</h3>\n<p><strong>McAfee says that Linux-based containers are OK</strong>. This means if you‚Äôre using a language or tools that require Windows containers, you may be able to move to something that doesn‚Äôt require them. This means you could use .NET Core, or potentially something else to run on a Linux container, which <em>is</em> supported.</p>\n<p>I know this isn‚Äôt much help, particularly if you have a large application already that you‚Äôre moving to Docker, but can be an option if you‚Äôre just starting out or if you are able to adjust your stack enough to be able to drop the Windows requirement.</p>\n<h3>Remove McAfee?</h3>\n<p>One of the possible solutions is to move away from McAfee. If Windows Docker containers are a hard requirement for you and no other options work well for your team, this might be the only option. </p>\n<h2>The bottom line</h2>\n<p>Basically, McAfee is really tough to work around as a developer, and Windows Docker containers are no exception. You have a limited options in the meantime, but I feel like the best recommendation is to not waste your time with workarounds and wait it out. McAfee should have an update at some point in the future to fix the issue. If you can‚Äôt afford to wait and the workarounds aren‚Äôt options, remember that making your voice heard on Twitter and Email and letting McAfee know this is important will go a long way in having them increase this as a priority.</p>"}